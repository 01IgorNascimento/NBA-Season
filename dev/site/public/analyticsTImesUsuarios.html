<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/dramTeam.css">
    <link rel="stylesheet" href="css/tabela.css">
    <link rel="import" href="fonts/quicksand/">
    <title>Analytics Time Usuarios</title>
    <script src="js/funcoes.js"></script>
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#000000">
</head>
<body onload="atualizarTabela()">
    <span id="meuNome">IGOR NASCIMENTO</span>

    <header class="cabecalho">
        <div class="caixa_logo">
            <img src="img/talvez/kobe12.png" alt="" class="logo">
        </div>
        <div class="caixa_opcoes">
            <ul>
                <li id="ativado">Analytics</li>
                <li id="desativado" onclick="RedirecionarHome()">Home</li>
                <li id="desativado" onclick="RedirecionarLogin()">Minha conta</li>
            </ul>
        </div>
    </header>
    <div id="caixaTituloTabela">
        <h1 class="titulo" id="tituloTabela">Ranking dos Times Dos Usuários</h1>
    </div>
    <div class="caixaSubTituloTabela">
        <div class="caixaSelect">
        Modo de Ordenação:
        <select name="" id="modoOrdenacao" onchange="selecionaOrdenacao()">
            <option value="overhall" selected>Overrall</option>
            <option value="salario">Salário</option>
        </select>
        </div>
    </div>

    <table  id="tabelaCompleta">
        <thead>
          <tr>
  
            <th>Nº</th>
            <th>Nome Usuário</th>
            <th>Média do overall do time</th>
            <th>Jogador com maior overall</th>
            <th>Salário Anual do Time</th>
          </tr>
        <thead>
        <tbody id="tabela">
        </tbody>
      </table>
        <br><br><br><br>
    
</body>
</html>

<script>

function RedirecionarHome(){
        window.location="http://localhost:3333/index.html"
    }
    
    function RedirecionarLogin(){
        window.location="http://localhost:3333/login.html"
    }

  function atualizarTabela() {
        //aguardar();
        var tabela = document.querySelector("#tabela")

        fetch("/usuarios/listarTimeUsuarios").then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    /*var feed = document.getElementById("feed_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    feed.appendChild(mensagem);*/
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    console.log("Dados recebidos: ", JSON.stringify(resposta));
                    

                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];
                        var tr = document.createElement("tr");
            

                        console.log(sessionStorage.ID_USUARIO +publicacao.id )
                        if(sessionStorage.ID_USUARIO == publicacao.id){
                            tr.id = "suaPosicao"
                        }
                        var tdRanking = document.createElement("td");
                        var tdNomeUsuario = document.createElement("td");
                        var tdMediaOverall = document.createElement("td");
                        var tdMaiorOverall = document.createElement("td");
                        var tdSalarioTotal = document.createElement("td");

                        tdRanking.innerHTML=i+1
                        tdNomeUsuario.innerHTML=publicacao.nomeUsuario
                        tdMediaOverall.innerHTML=Number(publicacao.mediaOverhall).toFixed(0)
                        tdMaiorOverall.innerHTML = Number(publicacao.maior).toFixed(0)
                        var salario = publicacao.salario.toLocaleString('en-gb', { style: 'currency', currency: 'USD' });
                        tdSalarioTotal.innerHTML = salario
                        
                        tr.appendChild(tdRanking)
                        tr.appendChild(tdNomeUsuario)
                        tr.appendChild(tdMediaOverall)
                        tr.appendChild(tdMaiorOverall)
                        tr.appendChild(tdSalarioTotal)

                        tabela.appendChild(tr)
                        console.log("Tr Inseridas")
                    }


                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            finalizarAguardar();
        });
    }

  function atualizarTabelaSalario() {
    var tabela = document.querySelector("#tabela")
        //aguardar();
        fetch("/usuarios/listarTimeUsuariosSalario").then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    /*var feed = document.getElementById("feed_container");
                    var mensagem = document.createElement("span");
                    mensagem.innerHTML = "Nenhum resultado encontrado."
                    feed.appendChild(mensagem);*/
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {          
                    for (let i = 0; i < resposta.length; i++) {
                        var publicacao = resposta[i];
                        var tr = document.createElement("tr");
                        
                        if(sessionStorage.ID_USUARIO == publicacao.id){
                            tr.id = "suaPosicao"
                        }

                        var tdRanking = document.createElement("td");
                        var tdNomeUsuario = document.createElement("td");
                        var tdMediaOverall = document.createElement("td");
                        var tdMaiorOverall = document.createElement("td");
                        var tdSalarioTotal = document.createElement("td");

                        tdRanking.innerHTML=i+1
                        tdNomeUsuario.innerHTML=publicacao.nomeUsuario
                        tdMediaOverall.innerHTML=Number(publicacao.mediaOverhall).toFixed(0)
                        tdMaiorOverall.innerHTML = Number(publicacao.maior).toFixed(0)
                        var salario = publicacao.salario.toLocaleString('en-gb', { style: 'currency', currency: 'USD' });
                        tdSalarioTotal.innerHTML = salario
                        
                        tr.appendChild(tdRanking)
                        tr.appendChild(tdNomeUsuario)
                        tr.appendChild(tdMediaOverall)
                        tr.appendChild(tdMaiorOverall)
                        tr.appendChild(tdSalarioTotal)

                        tabela.appendChild(tr)
                    }


                    finalizarAguardar();
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
            finalizarAguardar();
        });
    }
    
function selecionaOrdenacao(){
    var recebeSelect =modoOrdenacao.value
    if(recebeSelect=='salario'){
        limparTabela()
        atualizarTabelaSalario()
    }
    if(recebeSelect=='overhall'){
        limparTabela()

        atualizarTabela()
    }
}


function limparTabela(){
    tabelaCompleta.innerHTML=`
        <thead>
          <tr>  
            <th>Nº</th>
            <th>Nome Usuário</th>
            <th>Média do overall do time</th>
            <th>Jogador com maior overall</th>
            <th>Salário Anual do Time</th>
          </tr>
        </thead>
        <tbody id="tabela">
        </tbody>
      `
}
  
</script>